/*! build date  2013-08-07 */
/*!
 * cuSel -- stylized replacement for standard select
 * 
 * https://github.com/fetis/cusel
 *   
 * @version 3.0 alpha
 *
 * @requires jQuery 1.7+     
 * @requires jScrollPane.js
 * @requires jquery.mousewheel.js
 * 
 * Originally based on cuSel 2.5 by Evgeniy Ryzhkov, Alexey Choporov & Roman Omelkovitch
 *  
 *  fix bug (position) 2015-11-24
 */

function cuSel(e){function s(){var e=a();$("html").off("click.cusel"),$("html").on("click.cusel",function(s){var i=$(s.target);if(i.attr("id"),i.prop("class"),(i.hasClass("cuselText")||i.hasClass("cuselFrameRight")||i.parents(".cuselText:first").length)&&!i.parents(".cusel:first").hasClass("classDisCusel")){var r=i.parents(".cusel:first").find(".cusel-scroll-wrap").eq(0);l(r)}else if(i.hasClass("cusel")&&!i.hasClass("classDisCusel")&&i.is("div")){var r=i.find(".cusel-scroll-wrap").eq(0);l(r)}else if(i.parents(".cuselItem:first").length&&!i.parents(".cuselItem:first").hasClass("cuselActive")||i.is(".cuselItem")&&!i.hasClass("cuselActive")){var a=i.is(".cuselItem")?i:i.parents(".cuselItem:first"),n=i.parents(".cusel:first").length?i.parents(".cusel:first"):$(e.data("cusel-select")),o=a.index();if(!n.length)return;n.removeClass("cuselOpen").find(".cuselActive").removeClass("cuselActive").end().find(".cuselItem").eq(o).addClass("cuselActive"),t(n,a),e.hide(),n.focus()}else{if(i.parents(".cusel-scroll-wrap").is("div"))return;e.is(":visible")&&(e.hide(),$(".cuselOpen").removeClass("cuselOpen"))}}),$(".cusel").off("keydown.cusel"),$(".cusel").on("keydown.cusel",function(e){var s,i=$(this),t=i.is(".cuselOpen")?!0:!1,l=$("#cuselBox");if(window.event?s=window.event.keyCode:e&&(s=e.which),null==s||0==s||9==s)return!0;if(-1!=i.prop("class").indexOf("classDisCusel"))return!1;switch(s){case 32:return t||i.trigger("click"),!1;case 40:case 39:if(t){var a=l.find(".cuselOptHover").eq(0).length?l.find(".cuselOptHover").eq(0):l.find(".cuselActive").eq(0),n=a.next();n.is(".cuselItem")&&(a.removeClass("cuselOptHover"),n.addClass("cuselOptHover"),r(l.find(".cusel-scroll-wrap").eq(0)))}else{var a=i.find(".cuselOptHover").eq(0).length?i.find(".cuselOptHover").eq(0):i.find(".cuselActive").eq(0),n=a.next();n.is(".cuselItem")&&n.trigger("click")}return!1;case 37:case 38:if(t){var a=l.find(".cuselOptHover").eq(0).length?l.find(".cuselOptHover").eq(0):l.find(".cuselActive").eq(0),o=a.prev();o.is(".cuselItem")&&(a.removeClass("cuselOptHover"),o.addClass("cuselOptHover"),r(l.find(".cusel-scroll-wrap").eq(0)))}else{var a=i.find(".cuselOptHover").eq(0).length?i.find(".cuselOptHover").eq(0):i.find(".cuselActive").eq(0),o=a.prev();o.is(".cuselItem")&&o.trigger("click")}return!1;case 27:t?(i.removeClass("cuselOpen"),l.hide()):i.blur();break;case 13:return t&&l.find(".cuselOptHover").eq(0).trigger("click").removeClass("cuselOptHover"),!1}});var s=[];$(".cusel").keypress(function(e){function i(){var e=[];for(var i in s)window.event?e[i]=s[i].keyCode:s[i]&&(e[i]=s[i].which),e[i]=String.fromCharCode(e[i]).toUpperCase();var t,l,a=n.find(".cuselItem label"),o=a.length;for(t=0;o>t;t++){var c=!0;for(var d in s)l=a.eq(t).text().charAt(d).toUpperCase(),l!=e[d]&&(c=!1);if(c){n.find(".cuselOptHover").removeClass("cuselOptHover").end().find(".cuselItem").eq(t).addClass("cuselOptHover"),r(n.find(".cusel-scroll-wrap").eq(0)),s=s.splice,s=[];break}}s=s.splice,s=[]}var t=$(this),l=t.is(".cuselOpen")?!0:!1;if(l){var a,n=$("#cuselBox");if(window.event?a=window.event.keyCode:e&&(a=e.which),null==a||0==a||9==a)return!0;if(-1!=$(this).prop("class").indexOf("classDisCusel"))return!1;s.push(e),clearTimeout($.data(this,"timer"));var o=setTimeout(function(){i()},500);if(t.data("timer",o))return!1}})}function t(e,s){var i=s.data("setclass")?s.data("setclass"):"",t=e.find(".cuselText").data("class")?e.find(".cuselText").data("class"):"",l=s.attr("val");"undefined"==typeof l&&(l=s.find("label").text()),e.find(".cuselText").removeClass(t).data("class",i).addClass(i).html(s.html()).end().find("input").val(l).change()}function l(e){var s=e.parent(".cusel"),i=a();if($(".cuselOpen").removeClass("cuselOpen"),i.is(":hidden")){i.empty(),e.clone(!0).appendTo(i).show(),i.show().data("cusel-select",s[0]),$.ui&&(i.position({my:"left top",at:"left bottom",of:s}),i.css("left",s.offset().left-($("html").width()-$("body").width())/2+"px"),i.attr("class",e.parent().attr("class").replace(/\bcusel\b|\bselect_styled\b|\bcuselScrollArrows\b/g,"").replace(/\s{2,}/g," "))),i.css("width",s.outerWidth()+"px"),s.addClass("cuselOpen");var t=s.hasClass("cuselScrollArrows");i.find(".cusel-scroll-pane").jScrollPaneCusel({showArrows:t}),r(i.find(".cusel-scroll-wrap"))}else i.hide().removeData("cusel-select")}function r(e){var s=e.find(".cuselOptHover:first").length?e.find(".cuselOptHover:first"):e.find(".cuselActive:first");if(e.find(".jScrollPaneTrack:first").length&&s.length){var i=s.position();e.find(".cusel-scroll-pane:first")[0].id,e.find(".cusel-scroll-pane")[0].scrollTo(i.top)}}function a(){var e=$("#cuselBox");return e.length||(e=$('<div id="cuselBox">').hide().appendTo("body")),e}$(e.changedEl).each(function(t){var l=$(this);if(l.is("select")){var r=l.outerWidth(),a=l.prop("class"),n=this.id?this.id:"cuSel-"+Date.now()+"-"+t,o=l.prop("name"),c=l.val(),d=l.find("option[value='"+c+"']").eq(0),u=d.attr("addTags")?d.attr("addTags"):"",h=d.data("setclass")?d.data("setclass"):"",p=(d.text(),l.prop("disabled")),v=e.scrollArrows,f=l.prop("onchange"),g=l.prop("tabindex"),w=l.prop("multiple");if(!n||w)return!1;p?(classDisCuselText="classDisCuselLabel",classDisCusel="classDisCusel"):(classDisCuselText="",classDisCusel=""),v&&(classDisCusel+=" cuselScrollArrows"),l.find("option").addClass("cuselItem"),d.addClass("cuselActive");var m=l.html(),b=m.replace(/option/gi,"span").replace(/value=/gi,"val="),C='<div class="cusel '+a+" "+classDisCusel+'" id=cuselFrame-'+n+' style="width:'+r+'px" tabindex="'+g+'"><div class="cuselFrameRight"></div><div data-class="'+h+'" class="cuselText '+h+'">'+u+"<label>"+d.text()+'</label></div><div class="cusel-scroll-wrap"><div class="cusel-scroll-pane" id="cusel-scroll-'+n+'">'+b+'</div></div><input type="hidden" id="'+n+'" name="'+o+'" value="'+c+'" /></div>';l.replaceWith(C),f&&$("#"+n).bind("change",f);var x,S=$("#cuselFrame-"+n),O=S.find("span.cuselItem");O.wrapInner("<label/>"),O.eq(0).find("label").text()?x=O.eq(0).innerHeight():(x=O.eq(1).innerHeight(),O.eq(0).css("height",O.eq(1).height())),O.length>e.visRows?S.find(".cusel-scroll-wrap").eq(0).css({height:x*e.visRows+"px",display:"none",visibility:"visible"}).children(".cusel-scroll-pane").css("height",x*e.visRows+"px"):S.find(".cusel-scroll-wrap").eq(0).css({display:"none",visibility:"visible"});var I=$("#cusel-scroll-"+n).find("span[addTags]"),T=I.length;for(i=0;T>i;i++)I.eq(i).prepend(I.eq(i).attr("addTags")).removeAttr("addTags");s()}})}function cuSelRefresh(e){var s,i=e.refreshEl.split(","),t=i.length;for(s=0;t>s;s++){var l=$(i[s]).parents(".cusel").find(".cusel-scroll-wrap").eq(0);l.find(".cusel-scroll-pane").jScrollPaneRemoveCusel(),l.css({visibility:"hidden",display:"block"});var r=l.find(".cuselItem"),a=r.eq(0).outerHeight();r.length>e.visRows?l.css({height:a*e.visRows+"px",display:"none",visibility:"visible"}).children(".cusel-scroll-pane").css("height",a*e.visRows+"px"):l.css({display:"none",visibility:"visible"})}}!function(e){e.jScrollPaneCusel={active:[]},e.fn.jScrollPaneCusel=function(s){s=e.extend({},e.fn.jScrollPaneCusel.defaults,s);var i=function(){return!1};return this.each(function(){function t(){var e=(K-R)/s.animateStep;e>1||-1>e?U(R+e):(U(K),ee())}var l=e(this),r=this.parentNode.offsetWidth;l.css("overflow","hidden");var a=this;if(e(this).parent().is(".jScrollPaneContainer")){var n=s.maintainPosition?l.position().top:0,o=e(this).parent(),c=r,d=o.outerHeight(),u=d;e(">.jScrollPaneTrack, >.jScrollArrowUp, >.jScrollArrowDown",o).remove(),l.css({top:0})}else{var n=0;this.originalPadding=l.css("paddingTop")+" "+l.css("paddingRight")+" "+l.css("paddingBottom")+" "+l.css("paddingLeft"),this.originalSidePaddingTotal=(parseInt(l.css("paddingLeft"))||0)+(parseInt(l.css("paddingRight"))||0);var c=r,d=l.innerHeight(),u=d;if(l.wrap("<div class='jScrollPaneContainer'></div>").parent().css({height:d+"px",width:c+"px"}),!window.navigator.userProfile){var h=parseInt(e(this).parent().css("border-left-width"))+parseInt(e(this).parent().css("border-right-width"));c-=h,e(this).css("width",c+"px").parent().css("width",c+"px")}e(document).bind("emchange",function(){l.jScrollPaneCusel(s)})}if(s.reinitialiseOnImageLoad){var p=e.data(a,"jScrollPaneImagesToLoad")||e("img",l),v=[];p.length&&p.each(function(i,t){e(this).bind("load",function(){-1==e.inArray(i,v)&&(v.push(t),p=e.grep(p,function(e){return e!=t}),e.data(a,"jScrollPaneImagesToLoad",p),s.reinitialiseOnImageLoad=!1,l.jScrollPaneCusel(s))}).each(function(){(this.complete||void 0===this.complete)&&(this.src=this.src)})})}var f=this.originalSidePaddingTotal,g={height:"auto",width:c-s.scrollbarWidth-s.scrollbarMargin-f+"px"};s.scrollbarOnLeft?g.paddingLeft=s.scrollbarMargin+s.scrollbarWidth+"px":g.paddingRight=s.scrollbarMargin+"px",l.css(g);var w=l.outerHeight(),m=d/w;if(.99>m){var b=l.parent();b.append(e('<div class="jScrollPaneTrack"></div>').css({width:s.scrollbarWidth+"px"}).append(e('<div class="jScrollPaneDrag"></div>').css({width:s.scrollbarWidth+"px"}).append(e('<div class="jScrollPaneDragTop"></div>').css({width:s.scrollbarWidth+"px"}),e('<div class="jScrollPaneDragBottom"></div>').css({width:s.scrollbarWidth+"px"}))));var C=e(">.jScrollPaneTrack",b),x=e(">.jScrollPaneTrack .jScrollPaneDrag",b);if(s.showArrows){var S,O,$,I,T=function(){(I>4||0==I%4)&&U(R+O*k),I++},j=function(){e("html").unbind("mouseup",j),S.removeClass("jScrollActiveArrowButton"),clearInterval($)},y=function(){e("html").bind("mouseup",j),S.addClass("jScrollActiveArrowButton"),I=0,T(),$=setInterval(T,100)};b.append(e("<div></div>").attr({"class":"jScrollArrowUp"}).css({width:s.scrollbarWidth+"px"}).bind("mousedown",function(){return S=e(this),O=-1,y(),this.blur(),!1}).bind("click",i),e("<div></div>").attr({"class":"jScrollArrowDown"}).css({width:s.scrollbarWidth+"px"}).bind("mousedown",function(){return S=e(this),O=1,y(),this.blur(),!1}).bind("click",i));var A=e(">.jScrollArrowUp",b),H=e(">.jScrollArrowDown",b);if(s.arrowSize)u=d-s.arrowSize-s.arrowSize,C.css({height:u+"px",top:s.arrowSize+"px"});else{var P=A.height();s.arrowSize=P,u=d-P-H.height(),C.css({height:u+"px",top:P+"px"})}}var q,D,k,L=e(this).css({position:"absolute",overflow:"visible"}),R=0,M=m*d/2,W=function(e,s){return 500},B=function(){ee(),q=x.offset(),q.top-=R,D=u-x[0].offsetHeight,k=2*s.wheelSpeed*D/w},z=function(s){return B(),M=W(s,"Y")-R-q.top,e("html").bind("mouseup",E).bind("mousemove",Y),!1},E=function(){e("html").unbind("mouseup",E).unbind("mousemove",Y),M=m*d/2},U=function(e){e=0>e?0:e>D?D:e,R=e,x.css({top:e+"px"});var i=e/D;L.css({top:(d-w)*i+"px"}),l.trigger("scroll"),s.showArrows&&(A[0==e?"addClass":"removeClass"]("disabled"),H[e==D?"addClass":"removeClass"]("disabled"))},Y=function(e){U(W(e,"Y")-q.top-M)},F=Math.max(Math.min(m*(d-2*s.arrowSize),s.dragMaxHeight),s.dragMinHeight);x.css({height:F+"px"}).bind("mousedown",z);var X,N,Q,_=function(){(N>8||0==N%4)&&U(R-(R-Q)/2),N++},Z=function(){clearInterval(X),e("html").unbind("mouseup",Z).unbind("mousemove",G)},G=function(e){Q=W(e,"Y")-q.top-M},J=function(s){B(),G(s),N=0,e("html").bind("mouseup",Z).bind("mousemove",G),X=setInterval(_,100),_()};C.bind("mousedown",J),b.bind("mousewheel",function(e,s){return B(),ee(),U(R-s*k),!1});var K,V,ee=function(){V&&(clearInterval(V),delete K)},se=function(i,r){if("string"==typeof i){if($e=e(i,l),!$e.length)return;i=$e.offset().top-l.offset().top}b.scrollTop(0),ee();var a=-i/(d-w)*D;r||!s.animateTo?U(a):(K=a,V=setInterval(t,s.animateInterval))};l[0].scrollTo=se,l[0].scrollBy=function(e){var s=-parseInt(L.css("top"))||0;se(s+e)},B(),se(-n,!0),e("*",this).bind("focus",function(){for(var i=e(this),t=0;i[0]!=l[0];)t+=i.position().top,i=i.offsetParent();var r=-parseInt(L.css("top"))||0,a=r+d,n=t>r&&a>t;if(!n){var o=t-s.scrollbarMargin;t>r&&(o+=e(this).height()+15+s.scrollbarMargin-d),se(o)}}),location.hash&&se(location.hash),e(document).bind("click",function(s){if($target=e(s.target),$target.is("a")){var i=$target.attr("href");"#"==i.substr(0,1)&&se(i)}}),e.jScrollPaneCusel.active.push(l[0])}else l.css({height:d+"px",width:c-this.originalSidePaddingTotal+"px",padding:this.originalPadding}),l.parent().unbind("mousewheel")})},e.fn.jScrollPaneRemoveCusel=function(){e(this).each(function(){$this=e(this);var s=$this.parent();s.is(".jScrollPaneContainer")&&($this.css({top:"",height:"",width:"",padding:"",overflow:"",position:""}),$this.attr("style",$this.data("originalStyleTag")),s.after($this).remove())})},e.fn.jScrollPaneCusel.defaults={scrollbarWidth:10,scrollbarMargin:5,wheelSpeed:18,showArrows:!1,arrowSize:0,animateTo:!1,dragMinHeight:1,dragMaxHeight:99999,animateInterval:100,animateStep:3,maintainPosition:!0,scrollbarOnLeft:!1,reinitialiseOnImageLoad:!1},e(window).bind("unload",function(){for(var s=e.jScrollPaneCusel.active,i=0;i<s.length;i++)s[i].scrollTo=s[i].scrollBy=null})}(jQuery),function(e){function s(s){var i=s||window.event,t=[].slice.call(arguments,1),l=0,r=0,a=0;return s=e.event.fix(i),s.type="mousewheel",i.wheelDelta&&(l=i.wheelDelta/120),i.detail&&(l=-i.detail/3),a=l,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(a=0,r=-1*l),void 0!==i.wheelDeltaY&&(a=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(r=-1*i.wheelDeltaX/120),t.unshift(s,l,r,a),(e.event.dispatch||e.event.handle).apply(this,t)}var i=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var t=i.length;t;)e.event.fixHooks[i[--t]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],s,!1);else this.onmousewheel=s},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],s,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery);